#!/usr/bin/env ruby
require 'bundler/setup'
require 'html2rss'
require 'html2rss/configs'

feed_name = ARGV[0]
params = Hash[ARGV[1..-1].map { |arg| arg.split('=') }]

global_config = {
  'headers' => {
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:67.0) Gecko/20100101 Firefox/67.0'
  }
}

feed_config = Html2rss::Configs.find_by_name(feed_name, params)

config = Html2rss::Config.new(feed_config, global_config)

if config.json?
  puts '*' * 80
  puts 'Converting response to XML. Result:'
  puts Html2rss::Item.send(:get_body_from_url, config.url, config)
  puts '*' * 80
end

puts Html2rss.feed(config)
